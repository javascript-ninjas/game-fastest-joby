!function(e){var t={};function s(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(a,r,function(t){return e[t]}.bind(null,r));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";s.r(t);let a=document.querySelector("#loader"),r=document.querySelector("#loader-progress");class i{static update(e){let t=i._castPercentToWidth(e);setTimeout(()=>{r.style.width=t},0)}static _castPercentToWidth(e){return e*i.WIDTH/100+"px"}static show(){a.style.display="block"}static hide(){setTimeout(()=>{r.style.width=0,a.style.display="none"},50)}}i.WIDTH=130;class o extends Phaser.State{preload(){this.game.load.spritesheet("2-32x32","assets/spritesheets/2-32x32.png",32,32),i.update(40),this.game.load.image("car-1","assets/sprites/car-1.png",32,32),this.game.load.image("car-2","assets/sprites/car-2.png",32,32),i.update(50),this.game.load.image("game-title","assets/images/backgrounds/game-title.png"),this.game.load.image("game-over","assets/images/backgrounds/game-over.png"),this.game.load.image("game-winner","assets/images/backgrounds/game-winner.png"),i.update(60),this.game.load.tilemap("map-1","assets/tilemaps/map-1.json",null,Phaser.Tilemap.TILED_JSON),i.update(70),this.game.load.image("button-play","assets/images/buttons/button-play.png"),this.game.load.image("button-retry","assets/images/buttons/button-retry.png"),i.update(80)}create(){setTimeout(()=>{this.game.state.start("Preload")},1e3)}}class n extends Phaser.State{preload(){i.update(90),this.game.add.sprite(0,0,"game-title"),this.game.add.button(I.WIDTH/2,I.HEIGHT/1.3,"button-play",this.playTheGame,this).anchor.setTo(.5,.5),i.update(100),i.hide()}playTheGame(){this.game.state.start("TheGame")}}class d{constructor(e){this.score=0,this.game=e,this.name=null,this.spriteName=null,this.scorePosition=null}getSprite(){return this._sprite}_setupSprite(){this._sprite=this.game.add.sprite(0,160,this.spriteName)}updateBody(){this._sprite.body.collideWorldBounds=!0,this._sprite.body.setSize(32,22,0,5),this._scoreText=this.game.add.text(...this.scorePosition,"",{fontSize:"16px",fill:"#fff"}),this._scoreText.fixedToCamera=!0,this._scoreText.setShadow(3,3,"rgba(0,0,0,0.5)",5)}refreshScore(){this._scoreText.setText(`${this.name} score: ${this.score} points`)}supportCarMove(e){e.up.isDown&&(this._sprite.body.y-=2.5),e.down.isDown&&(this._sprite.body.y+=2.5),e.left.isDown&&(this._sprite.body.x-=3.5),e.right.isDown&&(this._sprite.body.x+=3.5)}}class h extends d{constructor(e){super(...Array.prototype.slice.call(arguments)),this.name="Player",this.spriteName="car-2",this.scorePosition=[20,5],this._setupSprite(),console.info("new Player()")}getControl(){return this.game.input.keyboard.createCursorKeys()}}class l extends d{constructor(e){super(...Array.prototype.slice.call(arguments)),this.name="Enemy",this.spriteName="car-1",this.scorePosition=[600,5],this._setupSprite(),console.info("new Enemy()")}getControl(){let e=this.game.input.keyboard.createCursorKeys();return e.up=this.game.input.keyboard.addKey(Phaser.Keyboard.W),e.down=this.game.input.keyboard.addKey(Phaser.Keyboard.S),e.left=this.game.input.keyboard.addKey(Phaser.Keyboard.A),e.right=this.game.input.keyboard.addKey(Phaser.Keyboard.D),e}}let p,c,m,g,u,y,b,f=[],T=e=>{let t=(f=f.sort(function(e,t){return e.score<t.score?1:e.score>t.score?-1:0})).map((e,t)=>`${t+1}. ${e.name}: ${e.score} points`);e.add.text(I.WIDTH-300,40,t.join("\n"),{fontSize:"24px",fill:"#fff"})},S=()=>{f.forEach((e,t)=>{e.getSprite().destroy(),delete f[t]}),f=[]},x=(e,t,s,a)=>{t.forEach(t=>{let[r,i]=t;s.add(e.add.tileSprite(32*r,32*i,32,32,"2-32x32",a))}),s.enableBody=!0},w=[[3,1],[7,4],[15,5],[22,8],[29,1],[44,1],[51,8],[64,5],[72,2],[89,6],[97,8]],P=[[4,8],[20,1],[45,8],[57,1],[77,3],[99,2]],_=[[8,8],[21,4],[56,8]];class G extends Phaser.State{preload(){console.clear(),u=this.game.add.group(),y=this.game.add.group(),b=this.game.add.group(),x(this.game,w,u,79),x(this.game,P,y,171),x(this.game,_,b,28),(p=this.game.add.tilemap("map-1")).addTilesetImage("2-32x32"),p.setCollisionBetween(1,256),(c=p.createLayer("Tile Layer 1")).resizeWorld()}create(){this.game.physics.arcade.enable(u),this.game.physics.arcade.enable(y),this.game.physics.arcade.enable(b),m=new h(this.game),f.push(m),this.game.camera.follow(m.getSprite()),this.game.physics.arcade.enable(m.getSprite()),m.updateBody(),m.refreshScore(),g=new l(this.game),f.push(g),this.game.camera.follow(g.getSprite()),this.game.physics.arcade.enable(g.getSprite()),g.updateBody(),g.refreshScore()}applyRules(e){let t=e.getControl();e.supportCarMove(t),this.game.physics.arcade.collide(e.getSprite(),c),this.game.physics.arcade.collide(e.getSprite(),u,(t,s)=>{s.destroy(),e.score+=10,e.refreshScore()}),this.game.physics.arcade.collide(e.getSprite(),y,(t,s)=>{s.destroy(),e.score+=50,e.refreshScore()}),this.game.physics.arcade.collide(e.getSprite(),b,(e,t)=>{t.destroy(),this.game.state.start("GameOver")}),this.game.world.width-e.getSprite().x-e.getSprite().width<=0&&this.game.state.start("Winner")}update(){this.applyRules(m),this.applyRules(g)}}class H extends Phaser.State{preload(){this.game.add.sprite(0,0,"game-over"),this.game.add.button(I.WIDTH/2,I.HEIGHT/1.3,"button-retry",this.retryTheGame,this).anchor.setTo(.5,.5),T(this.game),S()}retryTheGame(){this.game.state.start("TheGame")}}class v extends Phaser.State{preload(){this.game.add.sprite(0,0,"game-winner"),this.game.add.button(I.WIDTH/2,I.HEIGHT/1.3,"button-retry",this.oneMoreTimeTheGame,this).anchor.setTo(.5,.5),T(this.game),S()}oneMoreTimeTheGame(){this.game.state.start("TheGame")}}class I{constructor(){i.update(10)}setup(){i.update(20);let e=new Phaser.Game(I.WIDTH,I.HEIGHT,Phaser.AUTO,"canvas");e.state.add("Boot",o),e.state.add("Preload",n),e.state.add("TheGame",G),e.state.add("GameOver",H),e.state.add("Winner",v),e.state.start("Boot"),i.update(30)}}I.WIDTH=800,I.HEIGHT=320;new class{constructor(){this.game=new I,this.game.setup()}}}]);